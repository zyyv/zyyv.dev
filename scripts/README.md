# 图片压缩脚本使用说明

## 功能简介

`squoosh.ts` 是一个用于压缩 `public/photos` 目录下图片的脚本，使用 [squoosh-next](https://github.com/google/squoosh) 进行高效的图片压缩。

## 支持的格式

- **输入格式**: JPG, JPEG, PNG, WebP
- **输出格式**:
  - JPG/JPEG → JPG (使用 MozJPEG)
  - PNG → PNG (使用 OxiPNG)
  - WebP → WebP
  - 其他格式 → WebP（默认）

## 使用方法

### 1. 直接运行脚本
```bash
pnpm compress
```

### 2. 手动运行脚本
```bash
esno scripts/squoosh.ts
```

## 压缩配置

脚本使用以下默认配置：

- **JPEG 压缩**:
  - 质量：80%
  - 渐进式：启用

- **WebP 压缩**:
  - 质量：80%
  - 方法：6（最高质量）

- **PNG 压缩**:
  - 级别：3（平衡速度和压缩率）
  - 隔行扫描：禁用

## 输出目录

压缩后的文件会保存在 `public/photos/compressed/` 目录下，文件名格式为 `原文件名_compressed.扩展名`。

## 📊 自动生成报告

脚本运行完成后会自动生成两个对比报告：

1. **`compression-report.md`** - 详细的压缩分析报告
2. **`size-comparison.md`** - 简洁的大小对比表格

报告包含以下内容：
- 📊 总体压缩统计
- 📋 详细的文件对比表
- 🎯 压缩效果分析
- 🏆 最佳压缩效果排名

## 压缩效果

根据测试结果，脚本可以实现：
- **平均压缩率**: 80-95%
- **文件大小**: 从 10-20MB 压缩到 1-4MB
- **保持良好的图片质量**

## 功能特点

1. **并行处理**: 利用多核 CPU 并行压缩多张图片
2. **自动创建目录**: 自动创建输出目录
3. **详细日志**: 显示压缩进度和结果统计
4. **错误处理**: 完善的错误处理机制
5. **压缩统计**: 显示原文件大小、压缩后大小和节省的空间

## 注意事项

- 确保有足够的磁盘空间存储压缩后的图片
- 压缩过程会占用较多 CPU 资源
- 大文件压缩可能需要较长时间
- 压缩后的文件不会覆盖原文件

## 自定义配置

如需调整压缩参数，可以修改 `scripts/squoosh.ts` 中的 `compressOptions` 配置对象。
